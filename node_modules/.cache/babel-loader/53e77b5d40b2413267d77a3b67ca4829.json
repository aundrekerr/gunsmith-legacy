{"ast":null,"code":"let manifest;\nexport const statWhiteList = [4284893193, // Rounds Per Minute\n2961396640, // Charge Time\n447667954, // Draw Time\n3614673599, // Blast Radius\n2523465841, // Velocity\n4043523819, // Impact\n1240592695, // Range\n1591432999, // Accuracy\n155624089, // Stability\n943549884, // Handling\n4188031367, // Reload Speed\n1345609583, // Aim Assistance\n3555269338, // Zoom\n2715839340, // Recoil Direction\n3871231066, // Magazine\n1931675084];\nconst statsNoBar = [4284893193, // Rounds Per Minute\n3871231066, // Magazine\n2961396640, // Charge Time\n447667954, // Draw Time\n1931675084, // Recovery\n2715839340 // Recoil Direction\n];\nexport const statsMs = [447667954, // Draw Time\n2961396640 // Charge Time\n];\nconst hiddenStatsWhitelist = [1345609583, // Aim Assistance\n3555269338, // Zoom\n2715839340 // Recoil Direction\n];\nexport function buildStats(theManifest, itemHash) {\n  console.log('building stats');\n  manifest = theManifest;\n  const itemDef = manifest.DestinyInventoryItemDefinition[itemHash];\n\n  if (!itemDef.stats || !itemDef.stats.statGroupHash) {\n    return null;\n  }\n\n  const statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n\n  if (!statGroup) {\n    return null;\n  }\n\n  let investmentStats = buildInvestmentStats(itemDef, statGroup);\n}\n\nfunction shouldShowStat(itemDef, statHash, statDisplays) {\n  if (statHash === 2961396640 && itemDef.itemCategoryHashes && itemDef.itemCategoryHashes.includes(3317538576)) {\n    return false;\n  }\n\n  return (// Must be on the whitelist\n    statWhiteList.includes(statHash) && ( // Must be on the list of interpolated stats, or included in the hardcoded hidden stats list\n    statDisplays.filter(s => statHash === s.statHash)[0] || hiddenStatsWhitelist.includes(statHash))\n  );\n}\n\nfunction buildInvestmentStats(itemDef, statGroup) {\n  const itemStats = itemDef.investmentStats;\n  const statDisplays = statGroup.scaledStats;\n  itemStats.map(itemStat => {\n    const statHash = itemStat.statTypeHash;\n\n    if (!itemStat || !shouldShowStat(itemDef, statHash, statDisplays)) {\n      return undefined;\n    }\n\n    const def = manifest.DestinyStatDefinition[statHash];\n\n    if (!def) {\n      return undefined;\n    }\n\n    return buildStat(itemStat, statGroup, def, statDisplays);\n  });\n}\n\nfunction buildStat(itemStat, statGroup, statDef, statDisplays) {\n  const statHash = itemStat.statTypeHash;\n  let value = itemStat.value || 0;\n  let maximumValue = statGroup.maximumValue;\n  let bar = !statsNoBar.includes(statHash);\n  let smallerIsBetter = false;\n  const statDisplay = statDisplays[statHash];\n  let intd = false;\n\n  if (statDisplay) {\n    const firstInterp = statDisplay.displayInterpolation[0];\n    const lastInterp = statDisplay.displayInterpolation[statDisplay.displayInterpolation.length - 1];\n    smallerIsBetter = firstInterp.weight > lastInterp.weight;\n    maximumValue = Math.max(statDisplay.maximumValue, firstInterp.weight, lastInterp.weight);\n    bar = !statDisplay.displayAsNumeric;\n    value = interpolateStatValue(value, statDisplay);\n    intd = true;\n    console.log('!');\n  }\n\n  value = Math.max(0, value);\n  console.log(manifest.DestinyStatDefinition[statHash].displayProperties.name, {\n    investmentValue: itemStat.value || 0,\n    value,\n    intd,\n    statHash,\n    displayProperties: statDef.displayProperties,\n    sort: statWhiteList.indexOf(statHash),\n    maximumValue,\n    bar,\n    smallerIsBetter\n  });\n}\n\nfunction interpolateStatValue(value, statDisplay) {\n  const interp = statDisplay.displayInterpolation;\n  value = Math.max(0, Math.min(value, statDisplay.maximumValue));\n  let endIndex = interp.findIndex(p => p.value > value);\n\n  if (endIndex < 0) {\n    endIndex = interp.length - 1;\n  }\n\n  const startIndex = Math.max(0, endIndex - 1);\n  const start = interp[startIndex];\n  const end = interp[endIndex];\n  const range = end.value - start.value;\n\n  if (range === 0) {\n    return start.weight;\n  }\n\n  const t = (value - start.value) / (end.value - start.value);\n  return Math.round(start.weight + t * (end.weight - start.weight));\n}","map":{"version":3,"sources":["/Users/aundrekerr/Projects/React2019/gunsmith3/src/utils/stats.js"],"names":["manifest","statWhiteList","statsNoBar","statsMs","hiddenStatsWhitelist","buildStats","theManifest","itemHash","console","log","itemDef","DestinyInventoryItemDefinition","stats","statGroupHash","statGroup","DestinyStatGroupDefinition","investmentStats","buildInvestmentStats","shouldShowStat","statHash","statDisplays","itemCategoryHashes","includes","filter","s","itemStats","scaledStats","map","itemStat","statTypeHash","undefined","def","DestinyStatDefinition","buildStat","statDef","value","maximumValue","bar","smallerIsBetter","statDisplay","intd","firstInterp","displayInterpolation","lastInterp","length","weight","Math","max","displayAsNumeric","interpolateStatValue","displayProperties","name","investmentValue","sort","indexOf","interp","min","endIndex","findIndex","p","startIndex","start","end","range","t","round"],"mappings":"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","sourcesContent":["let manifest;\n\nexport const statWhiteList = [\n\t4284893193, // Rounds Per Minute\n\t2961396640, // Charge Time\n\t447667954, // Draw Time\n\n\t3614673599, // Blast Radius\n\t2523465841, // Velocity\n\n\t4043523819, // Impact\n\t1240592695, // Range\n\t1591432999, // Accuracy\n\t155624089, // Stability\n\t943549884, // Handling\n\t4188031367, // Reload Speed\n\t\n\t1345609583, // Aim Assistance\n\t3555269338, // Zoom\n\t2715839340, // Recoil Direction\n\n\t3871231066, // Magazine\n\t1931675084, // Inventory Size\n];\n\nconst statsNoBar = [\n\t4284893193, // Rounds Per Minute\n\t3871231066, // Magazine\n\t2961396640, // Charge Time\n\t447667954, // Draw Time\n\t1931675084, // Recovery\n\t2715839340 // Recoil Direction\n];\n\nexport const statsMs = [\n\t447667954, // Draw Time\n\t2961396640 // Charge Time\n];\n\nconst hiddenStatsWhitelist = [\n\t1345609583, // Aim Assistance\n\t3555269338, // Zoom\n\t2715839340 // Recoil Direction\n];\n\n\nexport function buildStats(\n\ttheManifest,\n\titemHash\n) {\n\tconsole.log('building stats');\n\tmanifest = theManifest;\n\n\tconst itemDef = manifest.DestinyInventoryItemDefinition[itemHash];\n\tif (!itemDef.stats || !itemDef.stats.statGroupHash) {\n\t\treturn null;\n\t}\n\n\tconst statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n\tif (!statGroup) {\n\t\treturn null;\n\t}\n\n\tlet investmentStats = buildInvestmentStats(itemDef, statGroup)\n}\n\nfunction shouldShowStat(\n\titemDef, \n\tstatHash, \n\tstatDisplays\n) {\n\t\n\tif (\n\t\tstatHash === 2961396640 &&\n\t\titemDef.itemCategoryHashes &&\n\t\titemDef.itemCategoryHashes.includes(3317538576)\n\t) {\n\t\treturn false;\n\t}\n\t\n\treturn (\n\t\t// Must be on the whitelist\n\t\tstatWhiteList.includes(statHash) &&\n\t\t// Must be on the list of interpolated stats, or included in the hardcoded hidden stats list\n\t\t(statDisplays.filter(s => statHash === s.statHash)[0] || hiddenStatsWhitelist.includes(statHash))\n\t);\n}\n\nfunction buildInvestmentStats(\n\titemDef, \n\tstatGroup\n) {\n\tconst itemStats = itemDef.investmentStats;\n\tconst statDisplays = statGroup.scaledStats;\n\n\titemStats.map(itemStat => {\n\t\tconst statHash = itemStat.statTypeHash;\n\t\tif (!itemStat || !shouldShowStat(itemDef, statHash, statDisplays)) {\n\t\t\treturn undefined\n\t\t}\n\n\t\tconst def = manifest.DestinyStatDefinition[statHash];\n\t\tif (!def) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn buildStat(itemStat, statGroup, def, statDisplays);\n\t})\n}\n\nfunction buildStat(\n\titemStat,\n\tstatGroup,\n\tstatDef,\n\tstatDisplays\n) {\n\tconst statHash = itemStat.statTypeHash;\n\tlet value = itemStat.value || 0;\n\tlet maximumValue = statGroup.maximumValue;\n\tlet bar = !statsNoBar.includes(statHash);\n\tlet smallerIsBetter = false;\n\tconst statDisplay = statDisplays[statHash];\n\tlet intd = false;\n\n\tif ( statDisplay ) {\n\t\tconst firstInterp = statDisplay.displayInterpolation[0];\n\t\tconst lastInterp = statDisplay.displayInterpolation[statDisplay.displayInterpolation.length - 1];\n\n\t\tsmallerIsBetter = firstInterp.weight > lastInterp.weight;\n\t\tmaximumValue = Math.max(statDisplay.maximumValue, firstInterp.weight, lastInterp.weight);\n\t\tbar = !statDisplay.displayAsNumeric;\n\t\tvalue = interpolateStatValue(value, statDisplay);\n\t\tintd = true;\n\t\tconsole.log('!')\n\t}\n\tvalue = Math.max(0, value);\n\n\tconsole.log(\n\t\tmanifest.DestinyStatDefinition[statHash].displayProperties.name,\n\t\t{\n\t\t\tinvestmentValue: itemStat.value || 0,\n\t\t\tvalue,\n\t\t\tintd,\n\t\t\tstatHash,\n\t\t\tdisplayProperties: statDef.displayProperties,\n\t\t\tsort: statWhiteList.indexOf(statHash),\n\t\t\tmaximumValue,\n\t\t\tbar,\n\t\t\tsmallerIsBetter\n\t\t}\n\t)\n}\n\nfunction interpolateStatValue(\n\tvalue,\n\tstatDisplay\n) {\n\tconst interp = statDisplay.displayInterpolation;\n\n\tvalue = Math.max(0, Math.min(value, statDisplay.maximumValue));\n\n\tlet endIndex = interp.findIndex(p => p.value > value);\n\tif ( endIndex < 0) {\n\t\tendIndex = interp.length - 1;\n\t}\n\tconst startIndex = Math.max(0, endIndex - 1);\n\n\tconst start = interp[startIndex];\n\tconst end = interp[endIndex]\n\tconst range = end.value - start.value;\n\tif (range === 0) {\n\t\treturn start.weight;\n\t}\n\n\tconst t = (value - start.value) / (end.value - start.value);\n\n\treturn Math.round(start.weight + t * (end.weight - start.weight));\n}"]},"metadata":{},"sourceType":"module"}