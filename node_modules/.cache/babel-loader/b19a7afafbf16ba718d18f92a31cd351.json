{"ast":null,"code":"let manifest;\nexport const statWhiteList = [3614673599, // Blast Radius\n2523465841, // Velocity\n4043523819, // Impact\n1240592695, // Range\n1591432999, // Accuracy\n155624089, // Stability\n943549884, // Handling\n4188031367, // Reload Speed\n2837207746, // Swing Speed (sword)\n2762071195, // Efficiency (sword)\n209426660, // Defense (sword)\n1345609583, // Aim Assistance\n3555269338, // Zoom\n2715839340, // Recoil Direction\n4284893193, // Rounds Per Minute\n2961396640, // Charge Time\n447667954, // Draw Time\n3871231066, // Magazine\n1931675084, // Inventory Size\n925767036];\nconst statsNoBar = [4284893193, // Rounds Per Minute\n3871231066, // Magazine\n2961396640, // Charge Time\n447667954, // Draw Time\n1931675084, // Recovery\n2715839340 // Recoil Direction\n];\nexport const statsMs = [447667954, // Draw Time\n2961396640 // Charge Time\n];\nconst hiddenStatsWhitelist = [1345609583, // Aim Assistance\n3555269338, // Zoom\n2715839340 // Recoil Direction\n];\nexport function buildStats(theManifest, itemHash) {\n  // console.log('----- Building stats. -----');\n  manifest = theManifest;\n  const itemDef = manifest.DestinyInventoryItemDefinition[itemHash];\n\n  if (!itemDef.stats || !itemDef.stats.statGroupHash) {\n    return null;\n  }\n\n  const statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n\n  if (!statGroup) {\n    return null;\n  }\n\n  let investmentStats = buildInvestmentStats(itemDef, statGroup);\n  return investmentStats.sort((a, b) => {\n    return a.sort - b.sort;\n  });\n}\n\nfunction shouldShowStat(itemDef, statHash, statDisplays) {\n  if (statHash === 2961396640 && itemDef.itemCategoryHashes && itemDef.itemCategoryHashes.includes(3317538576)) {\n    return false;\n  }\n\n  return (// Must be on the whitelist\n    statWhiteList.includes(statHash) && ( // Must be on the list of interpolated stats, or included in the hardcoded hidden stats list\n    statDisplays.filter(s => statHash === s.statHash)[0] || hiddenStatsWhitelist.includes(statHash))\n  );\n}\n\nfunction buildInvestmentStats(itemDef, statGroup) {\n  const itemStats = itemDef.investmentStats;\n  const statDisplays = statGroup.scaledStats;\n  return itemStats.map(itemStat => {\n    const statHash = itemStat.statTypeHash;\n\n    if (!itemStat || !shouldShowStat(itemDef, statHash, statDisplays)) {\n      return undefined;\n    }\n\n    const def = manifest.DestinyStatDefinition[statHash];\n\n    if (!def) {\n      return undefined;\n    }\n\n    return buildStat(itemStat, statGroup, def, statDisplays);\n  });\n}\n\nfunction buildStat(itemStat, statGroup, statDef, statDisplays) {\n  const statHash = itemStat.statTypeHash;\n  let value = itemStat.value || 0;\n  let maximumValue = statGroup.maximumValue;\n  let bar = !statsNoBar.includes(statHash);\n  let smallerIsBetter = false;\n  const statDisplay = statDisplays.filter(s => statHash === s.statHash)[0];\n  let intd = false;\n\n  if (statDisplay) {\n    const firstInterp = statDisplay.displayInterpolation[0];\n    const lastInterp = statDisplay.displayInterpolation[statDisplay.displayInterpolation.length - 1];\n    smallerIsBetter = firstInterp.weight > lastInterp.weight;\n    maximumValue = Math.max(statDisplay.maximumValue, firstInterp.weight, lastInterp.weight);\n    bar = !statDisplay.displayAsNumeric;\n    value = interpolateStatValue(value, statDisplay);\n    intd = true;\n  }\n\n  value = Math.max(0, value);\n  return {\n    investmentValue: itemStat.value || 0,\n    value,\n    intd,\n    statHash,\n    displayProperties: statDef.displayProperties,\n    sort: statWhiteList.indexOf(statHash),\n    maximumValue,\n    bar,\n    smallerIsBetter\n  };\n}\n\nfunction interpolateStatValue(value, statDisplay) {\n  const interp = statDisplay.displayInterpolation;\n  value = Math.max(0, Math.min(value, statDisplay.maximumValue));\n  let endIndex = interp.findIndex(p => p.value > value);\n\n  if (endIndex < 0) {\n    endIndex = interp.length - 1;\n  }\n\n  const startIndex = Math.max(0, endIndex - 1);\n  const start = interp[startIndex];\n  const end = interp[endIndex];\n  const range = end.value - start.value;\n\n  if (range === 0) {\n    return start.weight;\n  }\n\n  const t = (value - start.value) / (end.value - start.value);\n  return Math.round(start.weight + t * (end.weight - start.weight));\n}\n\nexport function enhanceStatsWithPlugs(stats, hash, perks, mod, masterwork) {\n  const itemDef = manifest.DestinyInventoryItemDefinition[hash];\n  const statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n  const statDisplays = statGroup.scaledStats;\n  let noMWStats;\n  const modifiedStats = new Set();\n  Object.keys(perks).map(perk => {\n    const perkDef = manifest.DestinyInventoryItemDefinition[perks[perk].hash];\n\n    if (perkDef) {\n      if (perkDef.investmentStats.length > 0) {\n        for (const perkStat of perkDef.investmentStats) {\n          const statHash = perkStat.statTypeHash;\n          const itemStat = stats.filter(s => {\n            if (s) {\n              return statHash === s.statHash;\n            } else {\n              return false;\n            }\n          })[0]; // const itemStatIndex = stats.map(s => { \n          // \tif (s) return s.statHash; \n          // }).indexOf(statHash);\n\n          const value = perkStat.value || 0;\n\n          if (itemStat) {\n            itemStat.investmentValue += value;\n          } // else if (shouldShowStat(itemDef, statHash, statDisplays)) { // need to complete this \n          // \tconst stat = perkDef.investmentStats.find(\n          // \t\t\t(s) => s.statTypeHash === statHash\n          // \t\t);\n          // \tif (stat && stat.value) {\n          // \t\tconst statDef = manifest.DestinyStatGroupDefinition[statHash];\n          // \t\tconst builtStat = buildStat(stat, statGroup, statDef, statDisplays);\n          // \t}\n          // }\n\n\n          modifiedStats.add(statHash);\n        }\n      }\n    }\n\n    return true;\n  });\n\n  if (mod.hash !== 0) {\n    if (mod.investmentStats.length > 0) {\n      for (const perkStat of mod.investmentStats) {\n        const statHash = perkStat.statTypeHash;\n        const itemStat = stats.filter(s => {\n          if (s) {\n            return statHash === s.statHash;\n          } else {\n            return false;\n          }\n        })[0];\n        const value = perkStat.value || 0;\n\n        if (itemStat) {\n          itemStat.investmentValue += value;\n        }\n\n        modifiedStats.add(statHash);\n      }\n    }\n  }\n\n  noMWStats = JSON.parse(JSON.stringify(stats));\n\n  for (const stat of noMWStats) {\n    if (stat) {\n      if (modifiedStats.has(stat.statHash)) {\n        const statDisplay = statDisplays.filter(s => stat.statHash === s.statHash)[0];\n        stat.value = statDisplay ? interpolateStatValue(stat.investmentValue, statDisplay) : Math.min(stat.investmentValue, stat.maximumValue);\n      }\n    }\n  }\n\n  if (masterwork.hash !== 0) {\n    if (masterwork.investmentStats.length > 0) {\n      for (const perkStat of masterwork.investmentStats) {\n        const statHash = perkStat.statTypeHash;\n        const itemStat = stats.filter(s => {\n          if (s) {\n            return statHash === s.statHash;\n          } else {\n            return false;\n          }\n        })[0];\n        const value = perkStat.value || 0;\n\n        if (itemStat) {\n          itemStat.investmentValue += value;\n        }\n\n        modifiedStats.add(statHash);\n      }\n    }\n  }\n\n  for (const stat of stats) {\n    if (stat) {\n      if (modifiedStats.has(stat.statHash)) {\n        const statDisplay = statDisplays.filter(s => stat.statHash === s.statHash)[0];\n        stat.value = statDisplay ? interpolateStatValue(stat.investmentValue, statDisplay) : Math.min(stat.investmentValue, stat.maximumValue);\n      }\n    }\n  }\n\n  for (let i = 0; i <= stats.length; i++) {\n    const stat = stats[i];\n    const mw = noMWStats[i];\n\n    if (stat && mw) {\n      if (stat.value !== mw.value) {\n        stats[i].mwDiff = Math.abs(mw.value - stat.value);\n      }\n    }\n  }\n\n  return stats;\n}\nexport function buildSingleStat(stats, perk, weaponHash, mod, masterwork) {\n  console.log('----- Building single stat. -----');\n  const itemDef = manifest.DestinyInventoryItemDefinition[weaponHash]; // console.log(itemDef, mod, masterwork)\n\n  const statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n  const statDisplays = statGroup.scaledStats;\n  let noPerkStats;\n  let finalPerkVal;\n  const modifiedStats = new Set();\n  console.log(perk);\n\n  if (mod.hash !== 0) {\n    if (mod.investmentStats.length > 0) {\n      for (const perkStat of mod.investmentStats) {\n        const statHash = perkStat.statTypeHash;\n        const itemStat = stats.filter(s => {\n          if (s) {\n            return statHash === s.statHash;\n          } else {\n            return false;\n          }\n        })[0];\n        const value = perkStat.value || 0;\n\n        if (itemStat) {\n          itemStat.investmentValue += value;\n        }\n\n        modifiedStats.add(statHash);\n      }\n    }\n  }\n\n  if (masterwork.hash !== 0) {\n    if (masterwork.investmentStats.length > 0) {\n      for (const perkStat of masterwork.investmentStats) {\n        const statHash = perkStat.statTypeHash;\n        const itemStat = stats.filter(s => {\n          if (s) {\n            return statHash === s.statHash;\n          } else {\n            return false;\n          }\n        })[0];\n        const value = perkStat.value || 0;\n\n        if (itemStat) {\n          itemStat.investmentValue += value;\n        }\n\n        modifiedStats.add(statHash);\n      }\n    }\n  }\n\n  noPerkStats = JSON.parse(JSON.stringify(stats));\n\n  for (const stat of noPerkStats) {\n    if (stat) {\n      if (modifiedStats.has(stat.statHash)) {\n        const statDisplay = statDisplays.filter(s => stat.statHash === s.statHash)[0];\n        stat.value = statDisplay ? interpolateStatValue(stat.investmentValue, statDisplay) : Math.min(stat.investmentValue, stat.maximumValue);\n      }\n    }\n  }\n\n  const perkStatHash = perk.statTypeHash;\n  const itemStat = stats.filter(s => {\n    if (s) {\n      return perkStatHash === s.statHash;\n    } else {\n      return false;\n    }\n  })[0];\n  const settingVal = perk.value || 0;\n\n  if (itemStat) {\n    itemStat.investmentValue += settingVal;\n  }\n\n  modifiedStats.add(perkStatHash);\n\n  for (const stat of stats) {\n    if (stat) {\n      if (modifiedStats.has(stat.statHash)) {\n        const statDisplay = statDisplays.filter(s => stat.statHash === s.statHash)[0];\n        stat.value = statDisplay ? interpolateStatValue(stat.investmentValue, statDisplay) : Math.min(stat.investmentValue, stat.maximumValue);\n      }\n    }\n  }\n\n  for (let i = 0; i <= stats.length; i++) {\n    const stat = stats[i];\n    const p = noPerkStats[i];\n\n    if (stat && p) {\n      if (stat.value !== p.value) {\n        finalPerkVal = stat.value - p.value;\n      } else {// finalPerkVal = \n      }\n    }\n  }\n\n  return finalPerkVal;\n}","map":{"version":3,"sources":["/Users/aundrekerr/Projects/React2019/gunsmith3/src/utils/stats.js"],"names":["manifest","statWhiteList","statsNoBar","statsMs","hiddenStatsWhitelist","buildStats","theManifest","itemHash","itemDef","DestinyInventoryItemDefinition","stats","statGroupHash","statGroup","DestinyStatGroupDefinition","investmentStats","buildInvestmentStats","sort","a","b","shouldShowStat","statHash","statDisplays","itemCategoryHashes","includes","filter","s","itemStats","scaledStats","map","itemStat","statTypeHash","undefined","def","DestinyStatDefinition","buildStat","statDef","value","maximumValue","bar","smallerIsBetter","statDisplay","intd","firstInterp","displayInterpolation","lastInterp","length","weight","Math","max","displayAsNumeric","interpolateStatValue","investmentValue","displayProperties","indexOf","interp","min","endIndex","findIndex","p","startIndex","start","end","range","t","round","enhanceStatsWithPlugs","hash","perks","mod","masterwork","noMWStats","modifiedStats","Set","Object","keys","perk","perkDef","perkStat","add","JSON","parse","stringify","stat","has","i","mw","mwDiff","abs","buildSingleStat","weaponHash","console","log","noPerkStats","finalPerkVal","perkStatHash","settingVal"],"mappings":"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","sourcesContent":["let manifest;\n\nexport const statWhiteList = [\n\t3614673599, // Blast Radius\n\t2523465841, // Velocity\n\n\t4043523819, // Impact\n\t1240592695, // Range\n\t1591432999, // Accuracy\n\t155624089, // Stability\n\t943549884, // Handling\n\t4188031367, // Reload Speed\n\n\t2837207746, // Swing Speed (sword)\n\t2762071195, // Efficiency (sword)\n\t209426660, // Defense (sword)\n\t\n\t1345609583, // Aim Assistance\n\t3555269338, // Zoom\n\t2715839340, // Recoil Direction\n\n\t4284893193, // Rounds Per Minute\n\t2961396640, // Charge Time\n\t447667954, // Draw Time\n\n\t3871231066, // Magazine\n\t1931675084, // Inventory Size\n\t925767036, // Ammo Capacity\n];\n\nconst statsNoBar = [\n\t4284893193, // Rounds Per Minute\n\t3871231066, // Magazine\n\t2961396640, // Charge Time\n\t447667954, // Draw Time\n\t1931675084, // Recovery\n\t2715839340 // Recoil Direction\n];\n\nexport const statsMs = [\n\t447667954, // Draw Time\n\t2961396640 // Charge Time\n];\n\nconst hiddenStatsWhitelist = [\n\t1345609583, // Aim Assistance\n\t3555269338, // Zoom\n\t2715839340 // Recoil Direction\n];\n\n\n\n\n\n\n\n\nexport function buildStats (\n\ttheManifest,\n\titemHash\n) {\n\t// console.log('----- Building stats. -----');\n\tmanifest = theManifest;\n\n\tconst itemDef = manifest.DestinyInventoryItemDefinition[itemHash];\n\tif (!itemDef.stats || !itemDef.stats.statGroupHash) {\n\t\treturn null;\n\t}\n\n\tconst statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n\tif (!statGroup) {\n\t\treturn null;\n\t}\n\n\tlet investmentStats = buildInvestmentStats(itemDef, statGroup);\n\treturn investmentStats.sort((a, b) => { return a.sort-b.sort })\n}\n\nfunction shouldShowStat (\n\titemDef, \n\tstatHash, \n\tstatDisplays\n) {\n\t\n\tif (\n\t\tstatHash === 2961396640 &&\n\t\titemDef.itemCategoryHashes &&\n\t\titemDef.itemCategoryHashes.includes(3317538576)\n\t) {\n\t\treturn false;\n\t}\n\t\n\treturn (\n\t\t// Must be on the whitelist\n\t\tstatWhiteList.includes(statHash) &&\n\t\t// Must be on the list of interpolated stats, or included in the hardcoded hidden stats list\n\t\t(statDisplays.filter(s => statHash === s.statHash)[0] || hiddenStatsWhitelist.includes(statHash))\n\t);\n}\n\nfunction buildInvestmentStats (\n\titemDef, \n\tstatGroup\n) {\n\tconst itemStats = itemDef.investmentStats;\n\tconst statDisplays = statGroup.scaledStats;\n\n\treturn itemStats.map(itemStat => {\n\t\tconst statHash = itemStat.statTypeHash;\n\t\tif (!itemStat || !shouldShowStat(itemDef, statHash, statDisplays)) {\n\t\t\treturn undefined\n\t\t}\n\n\t\tconst def = manifest.DestinyStatDefinition[statHash];\n\t\tif (!def) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn buildStat(itemStat, statGroup, def, statDisplays);\n\t})\n}\n\nfunction buildStat (\n\titemStat,\n\tstatGroup,\n\tstatDef,\n\tstatDisplays\n) {\n\tconst statHash = itemStat.statTypeHash;\n\tlet value = itemStat.value || 0;\n\tlet maximumValue = statGroup.maximumValue;\n\tlet bar = !statsNoBar.includes(statHash);\n\tlet smallerIsBetter = false;\n\tconst statDisplay = statDisplays.filter(s => statHash === s.statHash)[0];\n\tlet intd = false;\n\n\tif ( statDisplay ) {\n\t\tconst firstInterp = statDisplay.displayInterpolation[0];\n\t\tconst lastInterp = statDisplay.displayInterpolation[statDisplay.displayInterpolation.length - 1];\n\n\t\tsmallerIsBetter = firstInterp.weight > lastInterp.weight;\n\t\tmaximumValue = Math.max(statDisplay.maximumValue, firstInterp.weight, lastInterp.weight);\n\t\tbar = !statDisplay.displayAsNumeric;\n\t\tvalue = interpolateStatValue(value, statDisplay);\n\t\tintd = true;\n\t}\n\tvalue = Math.max(0, value);\n\n\treturn {\n\t\tinvestmentValue: itemStat.value || 0,\n\t\tvalue,\n\t\tintd,\n\t\tstatHash,\n\t\tdisplayProperties: statDef.displayProperties,\n\t\tsort: statWhiteList.indexOf(statHash),\n\t\tmaximumValue,\n\t\tbar,\n\t\tsmallerIsBetter\n\t}\n}\n\nfunction interpolateStatValue (\n\tvalue,\n\tstatDisplay\n) {\n\tconst interp = statDisplay.displayInterpolation;\n\t\n\tvalue = Math.max(0, Math.min(value, statDisplay.maximumValue));\n\n\tlet endIndex = interp.findIndex(p => p.value > value);\n\tif (endIndex < 0) {\n\t\tendIndex = interp.length - 1;\n\t}\n\tconst startIndex = Math.max(0, endIndex - 1);\n\n\tconst start = interp[startIndex];\n\tconst end = interp[endIndex];\n\tconst range = end.value - start.value;\n\tif (range === 0) {\n\t\treturn start.weight;\n\t}\n\n\tconst t = (value - start.value) / (end.value - start.value);\n\treturn Math.round(start.weight + t * (end.weight - start.weight));\n}\n\nexport function enhanceStatsWithPlugs (\n\tstats,\n\thash,\n\tperks,\n\tmod,\n\tmasterwork\n) {\n\tconst itemDef = manifest.DestinyInventoryItemDefinition[hash];\n\tconst statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n\tconst statDisplays = statGroup.scaledStats;\n\tlet noMWStats;\n\tconst modifiedStats = new Set();\n\n\tObject.keys(perks).map(perk => {\n\t\tconst perkDef = manifest.DestinyInventoryItemDefinition[perks[perk].hash];\n\n\t\tif (perkDef) {\n\t\t\tif (perkDef.investmentStats.length > 0) {\n\t\t\t\tfor ( const perkStat of perkDef.investmentStats) {\n\t\t\t\t\tconst statHash = perkStat.statTypeHash;\n\t\t\t\t\tconst itemStat = stats.filter(s => { if (s) { return statHash === s.statHash } else { return false } })[0];\n\t\t\t\t\t// const itemStatIndex = stats.map(s => { \n\t\t\t\t\t// \tif (s) return s.statHash; \n\t\t\t\t\t// }).indexOf(statHash);\n\t\t\t\t\tconst value = perkStat.value || 0;\n\n\t\t\t\t\tif (itemStat) {\n\t\t\t\t\t\titemStat.investmentValue += value;\t\t\t\t\n\t\t\t\t\t} \n\t\t\t\t\t// else if (shouldShowStat(itemDef, statHash, statDisplays)) { // need to complete this \n\t\t\t\t\t// \tconst stat = perkDef.investmentStats.find(\n\t\t\t\t\t// \t\t\t(s) => s.statTypeHash === statHash\n\t\t\t\t\t// \t\t);\n\n\t\t\t\t\t// \tif (stat && stat.value) {\n\t\t\t\t\t// \t\tconst statDef = manifest.DestinyStatGroupDefinition[statHash];\n\t\t\t\t\t// \t\tconst builtStat = buildStat(stat, statGroup, statDef, statDisplays);\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\n\t\t\t\t\tmodifiedStats.add(statHash);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t});\n\n\tif ( mod.hash !== 0 ) {\n\t\tif (mod.investmentStats.length > 0) {\n\t\t\tfor ( const perkStat of mod.investmentStats) {\n\t\t\t\tconst statHash = perkStat.statTypeHash;\n\t\t\t\tconst itemStat = stats.filter(s => { if (s) { return statHash === s.statHash } else { return false } })[0];\n\t\t\t\tconst value = perkStat.value || 0;\n\t\t\t\tif (itemStat) { itemStat.investmentValue += value; }\n\t\t\t\tmodifiedStats.add(statHash);\n\t\t\t}\n\t\t}\n\t}\n\n\tnoMWStats = JSON.parse(JSON.stringify(stats));\n\n\tfor (const stat of noMWStats) {\n\t\tif (stat) {\n\t\t\tif ( modifiedStats.has(stat.statHash) ) {\n\t\t\t\tconst statDisplay = statDisplays.filter(s => stat.statHash === s.statHash )[0];\n\t\t\t\tstat.value = statDisplay\n\t\t\t\t\t? interpolateStatValue(stat.investmentValue, statDisplay)\n\t\t\t\t\t: Math.min(stat.investmentValue, stat.maximumValue);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif ( masterwork.hash !== 0 ) {\n\t\tif (masterwork.investmentStats.length > 0) {\n\t\t\tfor ( const perkStat of masterwork.investmentStats) {\n\t\t\t\tconst statHash = perkStat.statTypeHash;\n\t\t\t\tconst itemStat = stats.filter(s => { if (s) { return statHash === s.statHash } else { return false } })[0];\n\t\t\t\tconst value = perkStat.value || 0;\n\t\t\t\tif (itemStat) { itemStat.investmentValue += value; } \n\t\t\t\tmodifiedStats.add(statHash);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const stat of stats) {\n\t\tif (stat) {\n\t\t\tif ( modifiedStats.has(stat.statHash) ) {\n\t\t\t\tconst statDisplay = statDisplays.filter(s => stat.statHash === s.statHash )[0];\n\t\t\t\tstat.value = statDisplay\n\t\t\t\t\t? interpolateStatValue(stat.investmentValue, statDisplay)\n\t\t\t\t\t: Math.min(stat.investmentValue, stat.maximumValue);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor(let i = 0; i <= stats.length; i++) {\n\t\tconst stat = stats[i];\n\t\tconst mw = noMWStats[i];\n\n\t\tif (stat && mw) {\n\t\t\tif (stat.value !== mw.value) {\n\t\t\t\tstats[i].mwDiff = Math.abs(mw.value - stat.value);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn stats;\n}\n\n\n\n\n\n\n\nexport function buildSingleStat (\n\tstats,\n\tperk,\n\tweaponHash,\n\tmod,\n\tmasterwork\n) {\n\tconsole.log('----- Building single stat. -----');\n\n\tconst itemDef = manifest.DestinyInventoryItemDefinition[weaponHash];\n\t// console.log(itemDef, mod, masterwork)\n\tconst statGroup = manifest.DestinyStatGroupDefinition[itemDef.stats.statGroupHash];\n\tconst statDisplays = statGroup.scaledStats;\n\tlet noPerkStats;\n\tlet finalPerkVal;\n\tconst modifiedStats = new Set();\n\tconsole.log(perk)\n\n\tif ( mod.hash !== 0 ) {\n\t\tif (mod.investmentStats.length > 0) {\n\t\t\tfor ( const perkStat of mod.investmentStats) {\n\t\t\t\tconst statHash = perkStat.statTypeHash;\n\t\t\t\tconst itemStat = stats.filter(s => { if (s) { return statHash === s.statHash } else { return false } })[0];\n\t\t\t\tconst value = perkStat.value || 0;\n\t\t\t\tif (itemStat) { itemStat.investmentValue += value; }\n\t\t\t\tmodifiedStats.add(statHash);\n\t\t\t}\n\t\t}\n\t}\n\n\tif ( masterwork.hash !== 0 ) {\n\t\tif (masterwork.investmentStats.length > 0) {\n\t\t\tfor ( const perkStat of masterwork.investmentStats) {\n\t\t\t\tconst statHash = perkStat.statTypeHash;\n\t\t\t\tconst itemStat = stats.filter(s => { if (s) { return statHash === s.statHash } else { return false } })[0];\n\t\t\t\tconst value = perkStat.value || 0;\n\t\t\t\tif (itemStat) { itemStat.investmentValue += value; }\t\n\t\t\t\tmodifiedStats.add(statHash);\n\t\t\t}\n\t\t}\n\t}\n\n\tnoPerkStats = JSON.parse(JSON.stringify(stats));\n\n\tfor (const stat of noPerkStats) {\n\t\tif (stat) {\n\t\t\tif ( modifiedStats.has(stat.statHash) ) {\n\t\t\t\tconst statDisplay = statDisplays.filter(s => stat.statHash === s.statHash )[0];\n\t\t\t\tstat.value = statDisplay\n\t\t\t\t\t? interpolateStatValue(stat.investmentValue, statDisplay)\n\t\t\t\t\t: Math.min(stat.investmentValue, stat.maximumValue);\n\t\t\t}\n\t\t}\n\t}\n\n\t\n\tconst perkStatHash = perk.statTypeHash;\n\tconst itemStat = stats.filter(s => { if (s) { return perkStatHash === s.statHash } else { return false } })[0];\n\tconst settingVal = perk.value || 0;\n\tif (itemStat) { itemStat.investmentValue += settingVal; }\t\n\tmodifiedStats.add(perkStatHash);\n\n\tfor (const stat of stats) {\n\t\tif (stat) {\n\t\t\tif ( modifiedStats.has(stat.statHash) ) {\n\t\t\t\tconst statDisplay = statDisplays.filter(s => stat.statHash === s.statHash )[0];\n\t\t\t\tstat.value = statDisplay\n\t\t\t\t\t? interpolateStatValue(stat.investmentValue, statDisplay)\n\t\t\t\t\t: Math.min(stat.investmentValue, stat.maximumValue);\n\t\t\t}\n\t\t}\n\t}\t\n\n\tfor(let i = 0; i <= stats.length; i++) {\n\t\tconst stat = stats[i];\n\t\tconst p = noPerkStats[i];\n\n\t\tif (stat && p) {\n\t\t\tif (stat.value !== p.value) {\n\t\t\t\tfinalPerkVal = stat.value - p.value;\n\t\t\t} else {\n\t\t\t\t// finalPerkVal = \n\t\t\t}\n\t\t}\n\t}\n\n\treturn finalPerkVal;\n}"]},"metadata":{},"sourceType":"module"}